L.Polyline.include({_snakingTimestamp:0,_snakingRings:0,_snakingVertices:0,_snakingDistance:0,_snaking:!1,snakeIn:function(){if(!this._snaking&&"performance"in window&&"now"in window.performance&&this._map)return this._snaking=!0,this._snakingTime=performance.now(),this._snakingVertices=this._snakingRings=this._snakingDistance=0,this._snakeLatLngs||(this._snakeLatLngs=L.Polyline._flat(this._latlngs)?[this._latlngs]:this._latlngs),this._latlngs=[[this._snakeLatLngs[0][0],this._snakeLatLngs[0][0]]],this._update(),this._snake(),this.fire("snakestart"),this},_snake:function(){var s=performance.now(),n=(s-this._snakingTime)*this.options.snakingSpeed/1e3;return this._snakingTime=s,this._latlngs[this._snakingRings].pop(),this._snakeForward(n)},_snakeForward:function(s){var n=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingRings][this._snakingVertices]),i=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingRings][this._snakingVertices+1]),t=n.distanceTo(i);if(this._snakingDistance+s>t){if(this._snakingVertices++,this._latlngs[this._snakingRings].push(this._snakeLatLngs[this._snakingRings][this._snakingVertices]),this._snakingVertices>=this._snakeLatLngs[this._snakingRings].length-1){if(this._snakingRings>=this._snakeLatLngs.length-1)return this._snakeEnd();this._snakingVertices=0,this._snakingRings++,this._latlngs[this._snakingRings]=[this._snakeLatLngs[this._snakingRings][this._snakingVertices]]}return this._snakingDistance-=t,this._snakeForward(s)}this._snakingDistance+=s;var a=this._snakingDistance/t,e=i.multiplyBy(a).add(n.multiplyBy(1-a)),h=this._map.containerPointToLatLng(e);this._latlngs[this._snakingRings].push(h),this.setLatLngs(this._latlngs),this.fire("snake"),L.Util.requestAnimFrame(this._snake,this)},_snakeEnd:function(){this.setLatLngs(this._snakeLatLngs),this._snaking=!1,this.fire("snakeend")}}),L.Polyline.mergeOptions({snakingSpeed:100}),L.LayerGroup.include({_snakingLayers:[],_snakingLayersDone:0,snakeIn:function(){if("performance"in window&&"now"in window.performance&&this._map&&!this._snaking){this._snaking=!0,this._snakingLayers=[],this._snakingLayersDone=0;var s=Object.keys(this._layers);for(var n in s){var i=s[n];this._snakingLayers.push(this._layers[i])}return this.clearLayers(),this.fire("snakestart"),this._snakeNext()}},_snakeNext:function(){if(this._snakingLayersDone>=this._snakingLayers.length)return this.fire("snakeend"),void(this._snaking=!1);var s=this._snakingLayers[this._snakingLayersDone];return this._snakingLayersDone++,this.addLayer(s),"snakeIn"in s?(s.once("snakeend",(function(){setTimeout(this._snakeNext.bind(this),this.options.snakingPause)}),this),s.snakeIn()):setTimeout(this._snakeNext.bind(this),this.options.snakingPause),this.fire("snake"),this}}),L.LayerGroup.mergeOptions({snakingPause:200});