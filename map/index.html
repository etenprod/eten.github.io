<!DOCTYPE html><html><head>
<title>Большая карта Вестероса и Эссоса | 7Королевств</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="css/leaflet.css">
<script async src="js/analytics.js"></script><script async src="js/tag.js"></script><script src="js/jquery.min.js"></script>
<script src="js/leaflet.js" type="text/javascript"></script>
<script src="js/leaflet-hash.js" type="text/javascript"></script>
<script src="js/L.Polyline.SnakeAnim.js" type="text/javascript"></script>
<script src="js/L.TileLayer.NoGap.js"></script>

<script src="js/main.js" type="text/javascript"></script>
<script src="js/war.js" type="text/javascript"></script>
<script src="js/charpath.js" type="text/javascript"></script>
<script src="js/bounds.js" type="text/javascript"></script>

<link rel="stylesheet" href="css/leaflet-search.min.css">
<script src="js/fuse.js" type="text/javascript"></script>
<script src="js/leaflet-search.min.js"></script>

<link rel="stylesheet" href="css/leaflet.measure.css">
<script src="js/leaflet.measure.js"></script>

<link rel="stylesheet" href="css/leaflet.fullscreen.css">
<script src="js/leaflet.fullscreen.js"></script>
<link rel="stylesheet" href="css/core.css">

<meta name="description" content="Интерактивная карта Вестероса и Эссоса (мир Песни Льда и Пламени и Игры престолов).">
<meta name="keywords" content="Карта, Вестерос">
<meta property="og:title" content="Карта Вестероса и Эссоса">
<meta property="og:type" content="article">
<meta property="og:url" content="https://7kingdoms.ru/map/map_ru.html">
<meta property="og:image" content="images/images1.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:site_name" content="7Королевств ">
<meta property="og:description" content="Интерактивная карта Вестероса и Эссоса (мир Песни Льда и Пламени и Игры престолов) на русском языке">
<meta property="article:published_time" content="2017-01-10T17:15:17Z">
<meta property="article:modified_time" content="2017-11-22T20:20:32Z">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Карта Вестероса и Эссоса">
<meta name="twitter:description" content="Интерактивная карта Вестероса и Эссоса (мир Песни Льда и Пламени и Игры престолов) на русском языке">
<meta name="twitter:image" content="https://7kingdoms.ru/wp-content/uploads/2018/05/images1.jpg">
<meta itemprop="image" content="https://7kingdoms.ru/wp-content/uploads/2018/05/images1.jpg">
</head>
<body id="MapBody">
<div class="mapnav-toggle">
<a class="btn tglr" href="#">–</a>
<a class="btn tglr-about" href="#">?</a>
</div>
<div id="mapnav" class="map-overlay">
<div class="map-overlay-inner">
<div class="map-overlay-inner-header">
<h1>Вестерос и земли Эссоса</h1>
<h3>мир Дж. Р. Р. Мартина</h3>
<script src="js/share.js"></script>
<div class="ya-share2" data-curtain data-size="s" data-shape="round" data-more-button-type="short" data-services="vkontakte,facebook,telegram,twitter,reddit" data-url="https://7kingdoms.ru/map/map_ru.html"></div>
</div>
<div class="map-overlay-inner-content">
<div id="tab-1" class="tab-content control-group current">
<label class="control control--checkbox">Королевства
<img src="images/marker_king.png" style="float: right;max-height: 20px;">
<input type="checkbox" value="kingLayer" checked>
<div class="control__indicator"></div>
</label>
<label class="control control--checkbox">Замки
<img src="images/marker_castle.png" style="float: right;max-height: 20px;">
<input type="checkbox" value="castleLayer" checked>
<div class="control__indicator"></div>
</label>
<label class="control control--checkbox">Руины
<img src="images/marker_ruin.png" style="float: right;max-height: 20px;">
<input type="checkbox" value="ruinLayer" checked>
<div class="control__indicator"></div></label>
<label class="control control--checkbox">Поселения
<img src="images/marker_town.png" style="float: right;max-height: 20px;">
<input type="checkbox" value="townLayer" checked>
<div class="control__indicator"></div>
</label>
<label class="control control--checkbox">Реки и моря
<img src="images/marker_water.png" style="float: right;max-height: 20px;">
<input type="checkbox" value="waterLayer" checked>
<div class="control__indicator"></div>
</label>
<label class="control control--checkbox">Места
<img src="images/marker_place.png" style="float: right;max-height: 20px;">
<input type="checkbox" value="placeLayer" checked>
<div class="control__indicator"></div>
</label>
<label class="control control--checkbox">Пометки
<img src="images/marker_ppoint.png" style="float: right;max-height: 20px;">
<input type="checkbox" value="ppointLayer" checked>
<div class="control__indicator"></div>
</label>
<label class="control control--checkbox">Все пометки<input type="checkbox" class="allcheckers" value="geodata" checked><div class="control__indicator"></div></label>
</div>
<div id="tab-2" class="tab-content control-group">
<div class="select">
<select name="PathArrayList" id="PathArrayList">
<option value data-center>Пути героев (24)</option>
<option value="arya" data-center="1055,2205">Арья</option>
<option value="asha" data-center="591,3165">Аша</option>
<option value="bran" data-center="1052,2209">Бран</option>
<option value="barristan" data-center="1327,3626">Барристан</option>
<option value="brienne" data-center="1679,3865">Бриенна</option>
<option value="victarion" data-center="591,3165">Виктарион</option>
<option value="davos" data-center="1635,3454">Давос</option>
<option value="deni" data-center="2084,3600">Дени</option>
<option value="jaime" data-center="1052,2209">Джейме</option>
<option value="jon" data-center="1052,2209">Джон</option>
<option value="dunk" data-center="999,3967">Дунк и Эгг</option>
<option value="quentin" data-center="1184,4262">Квентин</option>
<option value="catelin" data-center="1052,2209">Кейтилин</option>
<option value="griff" data-center="2323,3546">Коннингтон</option>
<option value="myrcella" data-center="1052,2209">Мирцелла</option>
<option value="nym" data-center="2596,3673">Нимерия</option>
<option value="robb" data-center="1052,2209">Робб</option>
<option value="sansa" data-center="1052,2209">Санса</option>
<option value="stannis" data-center="1635,3454">Станнис</option>
<option value="samwell" data-center="1285,1713">Сэмвелл</option>
<option value="theon" data-center="1052,2209">Теон</option>
<option value="tyrion" data-center="1052,2209">Тирион</option>
<option value="eddard" data-center="1052,2209">Эддард</option>
<option value="eddardyoung" data-center="1411,3095">Эддард (в юности)</option>
</select>
<div class="select__arrow"></div>
</div>
<button class="clearpath">× сбросить</button>
</div>
<div id="tab-3" class="tab-content control-group">
<label class="control control--checkbox">Границы королевств<input type="checkbox" value="boundLayer"><div class="control__indicator"></div></label>
<label class="control control--checkbox">Восстание Святого Воинства<input type="checkbox" value="rebellionSeven"><div class="control__indicator"></div></label>
<label class="control control--checkbox">Танец Драконов<input type="checkbox" value="war4ddance"><div class="control__indicator"></div></label>
<label class="control control--checkbox">Восстание Баратеона<input type="checkbox" value="rebellionBar"><div class="control__indicator"></div></label>
<label class="control control--checkbox">Война Пяти королей<input type="checkbox" value="war5kingLayer"><div class="control__indicator"></div></label>
</div>
</div>
<div class="map-overlay-inner-footer">

</div>
</div>
</div>
<div id="map" class="map"></div>
<div class="modal" id="modal-about">
<div class="modal-bg modal-exit"></div>
<div class="modal-container">
<h2>Описание большой карты Вестероса и Эссоса</h2>
<p><em>Постоянная ссылка для карты: <a href="https://7kingdoms.ru/story/westerosmap4/">https://7kingdoms.ru/story/westerosmap4/</a></em></p>
<p>Предложения и замечания можно направить на <a href="https://7kingdoms.ru/talk/threads/364/">форум</a>, в <a href="https://7kingdoms.ru/story/westerosmap4/#comments">комментарии</a> или на электронную почту <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e187808fa1d68a888f86858e8c92cf">[email protected]</a></p>
<strong>Выходные данные:</strong>
<p><em>Карту нарисовала <b>Narwen</b> (профиль <a target="_blank" href="https://www.behance.net/Azaley">Behance</a>, <a target="_blank" href="https://www.instagram.com/7narwen/">Instagram</a>, <a href="/cdn-cgi/l/email-protection#91f7f0ffd1a6faf8fff6f5fefce2bfe3e4">эл. почта</a>) с использованием графического редактора Adobe Illustrator и JS-библиотек leaflet и jquery вместе с дополнениями (Leaflet-Polyline-SnakeAnim, leaflet-hash, Leaflet-fullscreen и leaflet-search). Все права на мир принадлежат Джорджу Р. Р. Мартину (George R. R. Martin) и всем, кому они принадлежат. Карта является некоммерческим проектом. Все права на графику принадлежат Narwen. Использование карты без письменного разрешения автора за пределами 7kingdoms.ru запрещено.</em></p>
<strong>Спойлеры:</strong>
<p>Траектории перемещения персонажей соответствуют последним вышедшим книгах, никак не связаны с событиями сериала. Подписи сражений содержат явные спойлеры. Остальные подписи могут содержать спойлеры, но не слишком существенные.</p>
<strong>Источники:</strong>
<p>Подробнее о картографии мира Мартина читайте статью: <a href="https://7kingdoms.ru/story/kartografiya-vesterosa/">«Терра инкогнита: особенности картографии Вестероса и Эссоса в «Песни Льда и Пламени»»</a>.</p>
<p>Большая карта Вестероса и Эссоса основана на картах к 5-му тому цикла «Танец с драконами» (2011 г.) и серии постеров «Земли Льда и Пламени» (2012 г.); положение части объектов уточнено по наименее достоверным из официально изданных материалов — картам из «Мира Льда и Пламени» (2014 г.). Все три источника в деталях расходятся между собой, но, будучи проверены лично Джорджем Мартином, считаются каноном.</p>
<p>План Королевской Гавани основан на плане из бумажной версии «Битвы королей» и специального электронного издания «Игры престолов» с расширенными материалами от издательства Voyager. Некоторые элементы восстановлены по карте из «Земель Льда и Пламени» и «Мира Льда и Пламени», однако часть содержания этих планов расходится с текстом и отброшено.</p>
<p>Детали официальных «книжных» карт, которые противоречили тексту саги, восстановлены по картам для сериала «Игра престолов» (карта из on-line гида и карты в роликах о мире для Blu-ray издания), созданным по первой концепции мира для «Земель Льда и Пламени». Замки из игр по мотивам книги и сериала нанесены по картам из этих игр.</p>
<p>Если положение объекта помечено с опорой на текст, то в карточке это помечается значком <span class="reveal-xy" style="float:none;opacity:1" title="Положение восстановлено по тексту"></span>; часто это значит, что положение объекта не противоречит книгам, не более того. Ошибки и неточности официальных карт исправлены по мотивам <a href="https://7kingdoms.ru/talk/threads/364/">обсуждения карты на форуме</a> (пользуясь случаем: спасибо всем, кто участвует и приглашаю присоединится всех, кто хочет добавить что-то еще).</p>
<p>Траектории перемещения героев восстановлены по тексту книг. Для ПОВ персонажей основной саги результат сверен с упрощенной картой путешествий из сборника постеров «Земли Льда и Пламени». Ускорять анимацию можно, изменяя масштаб карты.</p>
<p>Карта военных действий восстановлена по тексту и включает лишь самые важные конфликты. Границы Семи Королевств соответствуют картам «Мира Льда и Пламени», а границы государств Эссоса восстановлены по его тексту. Пометка «в прошлом» означает, что государство ныне не существует.</p>
<strong>Измерение расстояний:</strong>
<p>По словам мейстера Эймона, в Вестеросе во́роны летают немногим быстрее вестеросских голубей, поэтому для оценки используется средняя скорость полета почтового голубя (70 км/ч). Средняя скорость драконов с учетом времени на отдых расчитана как 455 км в день — эта оценка согласуется с сообщением о том, что Джейхейрис Миротворец со своей женой долетели из столицы в Старомест со срочным визитом и двумя остановками за 3 дня. Средняя скорость дневного перехода феодальной пехоты составляет 25 км в день — в основу взяты данные для войска Генриха V в битве при Креси или войска князя Дмитрия на Куликовом поле.</p>
<strong>Перевод:</strong>
<p>Перевод географических названий соответствует (или по меньшей мере стремится соответствовать) <a href="https://7kingdoms.ru/talk/threads/856/">глоссарию 7Королевств</a>, возникшему на основе работы над этой картой и позднее учитывающему перевод «Мира Льда и Пламени». Тем не менее, встроенный поиск позволяет искать по любому из употребительных названий, включая название на английском языке и различные официальные варианты перевода.</p>
<strong>Список изменений:</strong>
<p><em>(Изменение в подписях происходит регулярно и в списке ниже не отражается).</em></p>
<ul>
<li><b>02.04.2022 — v. 4.2.2</b>
<ul>
<li>На Железный островах подписи замков, название которых предположительно восходят к имени рода, оставлены только в карточках.</li>
</ul>
</li>
<li>19.01.2021 — v. 4.2.1
<ul>
<li>Обновление графического слоя карты и панели управления.</li>
<li>Исправлено: 1. Уступ Стервятников перенесен по тексту — к истоку (!) реки; 2. Подпись реки Верхняя Ройна исправлена; 3. Ни Сар перенесен к западу от реки ниже точки слияния рек.</li>
</ul></li>
<li>19.11.2020 — v. 4.2
<ul>
<li>Упрощение внешнего вида карты. Теперь пометки о том, восстановлено ли положение объекта по картам или по тексту, вынесено в карточку (раньше было помечено звездочкой и формой иконки). Новый план Королевской Гавани (объекты подписаны поверх плана, без цифр). Исторические врезки сдвинуты к области описания. Убрана врезка с гипотетической формой Ультоса.</li>
<li>Исправлено: положение замков на острове Дрифтмарк; положение Звездопада (раньше было не понятно, стоит ли замок в проливе или у берега реки), линия перемещений Аши.</li>
<li>Переименовано: Пограничный Риф, Принцево ущелье.</li>
</ul></li>
<li>30.09.2020 — v. 4.1.1
<ul>
<li>Добавлено: функция измерения расстояния; оценка времени, которое необходимо, чтобы это расстояние преодолеть во́рону, дракону или пехоте.</li>
</ul></li>
<li>22.11.2019 — v. 4.1.0
<ul>
<li>Обновление внешнего вида карты всех масштабов. Больше деталей и цветовые акценты для обозначения типа земель.</li>
<li>Добавлено: ключевые события Восстания Святого Воинства</li>
<li>Исправлено: перемещения молодого Эддарда; поиск/центрирование иконок по клику</li>
<li>Изменено: названия городов, разоренных дотракийцами, используются как дополнительные вместо основных.</li>
</ul></li>
<li>21.04.2019 — v. 4.0.7b
<ul><li>Добавлено: островки Эйгон, Висенья и Рейнис</li>
<li>Обновлено: Барроутон, Крапчатый Лес.</li>
<li>Исправлено: неправильное отображение масштаба</li>
</ul></li>
<li>22.11.2017 — v. 4.0.7
<ul><li>Добавлено: ссылки на врезки, +15 пометок</li>
<li>Обновлено: план Королевской Гавани, береговая линия возле города на основной карте.</li>
</ul></li>
<li>24.10.2017 — v. 4.0.6
<ul><li>Добавлено: план Королевской Гавани</li></ul></li>
<li>12.04.2017 — v. 4.0.5</li>
<li>06.03.2017 — v. 4.0.4
<ul><li>Исправлено: Простор (много).</li>
<li>Добавлено: +10 пометок, в основном в Дорне, в Штормовых землях и Просторе</li></ul></li>
<li>17.02.2017 — v. 4.0.3
<ul><li>Исправлено: Речные земли (почти полностью), Железные острова (почти полностью), север Долины Арренов.</li>
<li>Добавлено: +30 пометок, в основном в Речных землях и на Железных островах</li>
<li>Переименования: Три Золотые Короны → замок Холлардов, замок Рисвеллов не имеет названия, Коряжник → Плавник, Золотой Стог → Стог</li>
<li>Передвижения героев: исправлены Джейме, Кейтилин, Арья.</li></ul></li>
<li>26.01.2017 — v. 4.0.2
<ul><li>Исправлено положение: весь Перешеек, области вдоль Зеленого и Синего Зубцов, Шандистон, Лестница Гигантов, р. Желудевая, Солеварни, Шепчущий лес</li>
<li>Убрано: пропасть Нанн (пропасть ли?)</li>
<li>Добавлено: деревня в предгорьях Лунных гор</li>
<li>Передвижения героев: исправлены Робб, Теон, Джейме, Кейтилин</li></ul></li>
<li>12.01.2017 — v. 4.0.1
<ul><li>Исправлено положение: Копья Подводного Короля, Королевский лес, Дарри, Одинокий Светоч</li>
<li>Добавлено: дорога к Близнецам</li>
<li>Передвижения героев: исправлены Давос и Джейме</li></ul></li>
<li><b>10.01.2017 — v. 4.0.0</b></li>
</ul>
<button class="modal-close modal-exit">×</button>
</div>
</div>
<script data-cfasync="false" src="js/email-decode.min.js"></script><script type="text/javascript">

////////////////////////
// главные настройки и плагины
////////////////////////

// значения карты по умолчанию
var map = L.map('map', {
  crs: L.CRS.Simple,
  zoomControl:false,
  continuousWorld: false,
  attributionControl: false,
  maxNativeZoom:4,
  maxZoom: 3, 
  minZoom: 1,
//  measureControl: true,
  noWrap: true,
//  autoPan : false,
  autoPan : true
 }).setView([-450,180], 3);


var hash = new L.Hash(map);
var southWest = map.unproject([0, 6656], map.getMaxZoom());
var northEast = map.unproject([8192, 0], map.getMaxZoom());
var bounds = new L.LatLngBounds(southWest, northEast);
map.setMaxBounds(bounds);
map.on('drag', function() {
    map.panInsideBounds(bounds, { animate: false });
});
 
var westeros = L.tileLayer('tiles/base_v4_2_2/{z}/{y}/{x}.png', {});
westeros.addTo(map);


////////////////////////
// контролы
////////////////////////

new L.control.scale({imperial: false, metric: true, position: 'bottomleft'}).addTo(map);
new L.Control.Zoom({ position: 'bottomleft' }).addTo(map);
new L.Control.Fullscreen().addTo(map);


new L.control.measure({
    //  подтягиваем под масштаб карты
    formatDistance: function (val) {
      return Math.round(400 * val / 36);
    }
}).addTo(map)
new L.control.attribution({prefix: 'v. 4.2.2 | графика © Narwen'}).addTo(map);

////////////////////////
//кастомные функции для импорта geojson
////////////////////////

function pointToLayer(feature, latlng) {
	var newLatLng = map.unproject([latlng.lng, latlng.lat], map.getMaxZoom());
	return new L.marker(newLatLng, {
			icon : L.icon({
				iconUrl: 'distr/images/marker_'+feature.properties.cat+'.png',
				iconSize: [24, 24],
				iconAnchor: [12, 24],
				popupAnchor: [0, -16]
			}),
            riseOnHover: true,
            className: feature.properties.cat
    });
}
function warpointToLayer(feature, latlng) {
  var newLatLng = map.unproject([latlng.lng, latlng.lat], map.getMaxZoom());
  return new L.marker(newLatLng, {
      icon : L.icon({
        iconUrl: 'distr/images/marker_'+feature.properties.cat+'.png',
        iconSize: [24, 24],
        iconAnchor: [12, 24],
        popupAnchor: [0, -16]
      }),
            riseOnHover: true,
            className: feature.properties.cat
    });
}
function onEachFeature(feature, layer, latlng) {
	feature.layer = layer;

	var header = "<h3>" + feature.properties.name + "</h3>";
	var conflict = "";
	var loyal = "";
	var nonmapxy = "";

  if (feature.properties.url) { 
    var header = "<h3><a target=\"_top\" href=//7kingdoms.ru/wiki/"+feature.properties.url+">"+feature.properties.name+"</a></h3>";
  }

	if (feature.properties.english && !feature.properties.war_name) { 
		var header = header + "<span class=\"subhead\">" + feature.properties.english;
			if (feature.properties.synonym) { 
				var header = header + "</span><span class=\"vtrans\">Синоним: " + feature.properties.synonym + "</span>"; 
			} else { 
				var header = header + "</span>";
			}
	}

	if (feature.properties.war_name) {
		var conflict = "<span target=\"_top\" class=\"subtext\">★ <a href=//7kingdoms.ru/wiki/"+feature.properties.war_url+">"+feature.properties.war_name+"</a> ★</span>";
	} 
	if (feature.properties.loyal) { 
		var loyal = "<span class=\"subtext\">"+feature.properties.loyal+"</span>"; 
	}
	if (feature.properties.nonmap) { 
		var nonmapxy = "<span class=\"reveal-xy\" title=\"Положение восстановлено по тексту\"></span>"; 
	}

	var desc = "<div class=\"content-header\">" + header + "</div><div class=\"content-main\">" + feature.properties.description + "</div><div class=\"content-main2\">" + conflict + nonmapxy + loyal + "</div>";
	
	layer.bindPopup(desc, {maxWidth:250, autoPan: true, autoPanPaddingBottomRight: [235, 50], autoPanPaddingTopLeft: [60, 10]});
 //   layer.on('mouseover', function (e) {this.openPopup();});
 //   layer.on('mouseout', function (e) {this.closePopup();});

 if (feature.properties.war_conflict) {
    var warnumber = feature.properties.war_conflict;
    layer.bindTooltip(warnumber, {
      direction: "center",
      permanent: "true", 
      className: "tooltip waricon", 
      offset: [-5, 5]
    })
  }
}

function onEachFeaturePath(feature, layer) {
  feature.layer = layer;
  var charname = feature.properties.character;
  layer.bindTooltip(charname, {
      sticky: "true",
//      className: "tooltip", 
    })
}

function pathStyle(feature) {
        return {
			color: feature.properties.stroke,
			opacity: 0.7,
			weight: 6,
		//	dashArray: 5
			};
    };

function pathCoordsToLatLng (newcoords) {
        return (map.unproject([newcoords[0], newcoords[1]], map.getMaxZoom()));
    };

////////////////////////
//грузим данные иконок
////////////////////////

var castleLayer = new L.GeoJSON(grrmmap.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "castle";}
});

var ruinLayer = new L.GeoJSON(grrmmap.features, {
  pointToLayer: pointToLayer,
  onEachFeature: onEachFeature,
  filter: function(feature, layer) {return feature.properties.cat == "ruin";}
});

var townLayer = new L.GeoJSON(grrmmap.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "town";}
});

var placeLayer = new L.GeoJSON(grrmmap.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "place";}
});

var kingLayer = new L.GeoJSON(grrmmap.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "king";}
});

var waterLayer = new L.GeoJSON(grrmmap.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "water";}
});

var ppointLayer = new L.GeoJSON(grrmmap.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "ppoint";}
});

var geodata = L.layerGroup([
	castleLayer, 
    ruinLayer,
	townLayer, 
	placeLayer, 
	kingLayer, 
	waterLayer, 
	ppointLayer
	])
.addTo(map);

////////////////////////
//грузим данные о границах
////////////////////////

var boundLayer;

function styleBound(feature) {
    return {
        fillColor: feature.properties.bg,
        weight: 1,
        color: 'white',
        fillOpacity: 0.2
    };
}

function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 4,
        color: 'yellow',
        fillOpacity: 0.5
    });
}

function resetHighlight(e) {
    boundLayer.resetStyle(e.target);
}

function onEachFeatureBound(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
    });
  layer.bindTooltip(feature.properties.name, {
      sticky: "true",
//      className: "tooltip", 
    })
}

var boundLayer = new L.GeoJSON(kingdoms.features, {
  coordsToLatLng: pathCoordsToLatLng,
  style: styleBound,
  onEachFeature: onEachFeatureBound
});

////////////////////////
//грузим данные о войне
////////////////////////

var war5kingLayer = new L.GeoJSON(grrmwars.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "war_5king";}
});

var war4ddance = new L.GeoJSON(grrmwars.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "war_ddance";}
});

var rebellionBar = new L.GeoJSON(grrmwars.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "war_baratheon";}
});

var rebellionSeven = new L.GeoJSON(grrmwars.features, {
	pointToLayer: pointToLayer,
	onEachFeature: onEachFeature,
	filter: function(feature, layer) {return feature.properties.cat == "war_faith";}
});

var geodata_war = L.layerGroup([
	war5kingLayer, 
	war4ddance, 
	rebellionBar,
	rebellionSeven
	])
//.addTo(map);

////////////////////////
// поиск
////////////////////////

var fuse = new Fuse(grrmmap.features, {
		  threshold: 0.3,
		  minMatchCharLength: 3,
		  //includeScore: true,
		  keys: [{
    		name: 'properties.name',
    		weight: 0.6
  			}, {
    		name: 'properties.synonym',
    		weight: 0.1
    		}, {
    		name: 'properties.english',
    		weight: 0.1
    		}, {
    		name: 'properties.loyal',
    		weight: 0.2
  		}]
});

L.control.search({
		layer: geodata,
//		initial: false,
		propertyName: 'name',
		position: 'topleft',
		zoom: 3,
		autoType: false,
//		collapsed: false,
		minLength: 2,
		tooltipLimit: 10,
		autoResize: false,
		textErr: 'Не найдено',
		textCancel: 'Сбросить',			
		textPlaceholder: 'Поиск…       ',	
		filterData: function(text, records) {
			var jsons = fuse.search(text),
				ret = {}, key;
			
			for(var i in jsons) {
				key = jsons[i].properties.name;
				ret[key]= records[key];
			}

			console.log(jsons,ret);
			return ret;
		}
})
.on('search:locationfound', function(e) {
		e.layer.openPopup();
}).addTo(map);

////////////////////////
// кастомный контрол
////////////////////////

var PathLayer = {};
var PathLine = L.geoJson([]);

$('#PathArrayList').change(function(e){ 
  PathLine.clearLayers();
  var PathLayer = $(this).val();

  var PathCenter = $(this).find(':selected').data('center').split(',');
  var newLatLng = map.unproject(PathCenter, map.getMaxZoom());
  map.panTo(newLatLng); 
  
  PathLine = L.geoJson(charpath, {
    style: pathStyle,
    coordsToLatLng: pathCoordsToLatLng,
    onEachFeature: onEachFeaturePath,
    filter: function(feature) {
      return feature.properties.charlayer == PathLayer;
    }
  });

  PathLine.addTo(map).snakeIn();
});


$( ".clearpath" ).click(function( event ) {
  PathLine.clearLayers();
  return false;
});

$( "input" ).click(function( event ) {
        layerClicked = window[event.target.value];
            if (map.hasLayer(layerClicked)) {
                map.removeLayer(layerClicked);
            }
            else{
                map.addLayer(layerClicked);
            } ;
});

$(".allcheckers").change(function () {
    $("#tab-1 input:checkbox").prop('checked', $(this).prop("checked"));
});

$(":checkbox").attr("autocomplete", "off");

$( ".tglr" ).on("click" , function(){
  $( "#mapnav" ).slideToggle( "slow" );
  $(this).text(function(i, v){
               return v === '+' ? '–' : '+'
  })
  return false;
});


////////////////////////
// Попап
////////////////////////

$( ".tglr-about" ).on("click" , function(){
  $( "#modal-about" ).toggleClass("open");
  $( ".modal-exit" ).on("click" , function(){
	$( "#modal-about" ).removeClass("open");
  });
  return false;
});


  
////////////////////////
// Переход по клику на координаты
////////////////////////

$('#map').on('click', '.flyToPoint', function() {
  		var new_point = $(this).data("point").split(",");
		var new_latlan = map.unproject(new_point, map.getMaxZoom());
		map.flyTo(new_latlan, 3);
		return false;
});

////////////////////////
// Переход между иконками
////////////////////////



</script>
<script src="js/share.js" defer></script>
 <script type="text/javascript"> (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(21178511, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true }); </script> <noscript><div><img src="https://mc.yandex.ru/watch/21178511" style="position:absolute; left:-9999px;" alt></div></noscript> 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-7415551-1', 'auto');
  ga('send', 'pageview');
  setTimeout("ga('send', 'event', '15 seconds', 'read')",15000);
</script>


</body></html>